# 群れ行動シミュレーションにおける Confusion Effect 検証実験：事前セットアップ

## 1. 研究の背景

### 1.1 群れ行動の進化的意義

自然界において多くの動物が群れを形成して行動する現象は、捕食者からの防御、採餌効率の向上、移動コストの削減など、複数の適応的利点によって説明されてきた。特に捕食回避において、群れは以下のような防御機構を提供すると考えられている。

1. **希釈効果（Dilution Effect）**: 群れの個体数が多いほど、個々の個体が捕食される確率が低下する。
2. **多くの目効果（Many Eyes Effect）**: 群れ全体として捕食者を検出する確率が高まる。
3. **混乱効果（Confusion Effect）**: 群れ内の多数の個体が捕食者の標的選択を困難にする。

本実験では、これらのうち **Confusion Effect** に焦点を当て、コンピュータシミュレーションによりその効果を定量的に検証する。

### 1.2 Confusion Effect とは

Confusion Effect は、捕食者が多数の潜在的な獲物に直面したとき、標的の選択と追跡が困難になる現象である。神経科学的には、視覚システムが同時に複数の移動する対象を追跡することの限界に起因すると考えられている。

Ioannou et al. (2008) は、人工ニューラルネットワークを用いた実験により、標的の数が増加すると追跡精度が低下することを示した。彼らの研究では、捕食者が複数の獲物を視野に捉えたとき、「最後に視野に入った個体に注意が移る」という行動パターンが観察された（論文 Fig.2）。

### 1.3 先行研究

本実験の理論的基盤となる主要な先行研究を以下に示す。

| 研究者 | 年 | 貢献 |
|--------|-----|------|
| Reynolds, C. W. | 1987 | Boid アルゴリズムの提案。Alignment, Cohesion, Separation の3つの力により群れ行動を再現 |
| Couzin, I. D. et al. | 2002 | 群れ内の情報伝達と空間的整列に関する理論モデル |
| Ioannou, C. C. et al. | 2008 | Confusion Effect の神経科学的メカニズムと捕食リスクへの影響を定量化 |

---

## 2. 仮説

本実験では、以下の3つの仮説を検証する。

### 仮説1：個体数の影響

> **群れの個体数が増加するほど、Confusion Effect により捕食者の捕食効率が低下する。**

理論的根拠：視野内の個体数が増加すると、捕食者の標的選択が困難になり、追跡精度が低下する。

### 仮説2：群れの密度の影響

> **群れの結合力（Cohesion Weight）が高く、個体が密集しているほど、Confusion Effect が強く発揮され、捕食効率が低下する。**

理論的根拠：密集した群れでは、捕食者の視野内に同時に多数の個体が入るため、混乱が生じやすい。一方、疎な群れでは個体が分散しており、捕食者は個別の個体を追跡しやすい。

### 仮説3：Confusion Effect の直接的影響

> **Confusion Strength パラメータを増加させると、捕食者の追跡精度が低下し、捕食効率が低下する。**

理論的根拠：Ioannou et al. (2008) の知見に基づき、視野内の個体数に比例して追跡角度のずれと旋回速度の低下を実装した。このパラメータを操作することで、Confusion Effect の効果を直接検証する。

---

## 3. シミュレーションモデルの設計

### 3.1 シミュレーション環境

- **エンジン**: Unity 2022.3（LTS）
- **空間**: 半径50mの球形空間（原点を中心）
- **時間刻み**: 可変フレームレート（`Time.deltaTime` による正規化）

球形空間を採用した理由は、壁との衝突による不自然な群れの崩壊を避け、自然な回遊行動を再現するためである。

### 3.2 被捕食者（Boid）のモデル

被捕食者は Reynolds (1987) の Boid アルゴリズムに基づいて実装された。各個体は周囲の仲間の位置と速度を感知し、以下の3つの力の合成により移動する。

#### 3.2.1 基本パラメータ

| パラメータ | 値 | 設計理由 |
|------------|-----|----------|
| minSpeed | 2 m/s | 停止を防ぎ、常に遊泳状態を維持 |
| maxSpeed | 5 m/s | 捕食者（10 m/s）より遅く設定し、逃走だけでは生存できないようにする |
| perceptionRadius | 2.5 m | 近傍の仲間を認識する範囲。群れの局所的な構造を決定 |
| avoidanceRadius | 1 m | 個体間の最小距離。衝突を防止 |
| maxSteerForce | 3 | 急激な方向転換を制限し、自然な動きを実現 |

#### 3.2.2 群れ行動の重み（BoidSettings）

| パラメータ | 説明 | 実験での操作 |
|------------|------|--------------|
| alignWeight | 周囲の仲間と同じ方向に向かう力 | 固定（1） |
| cohesionWeight | 周囲の仲間の重心に向かう力 | **実験Bで操作（1, 5, 15）** |
| seperateWeight | 近づきすぎた仲間から離れる力 | 固定（1） |

**cohesionWeight の設計理由**:
- **cohesionWeight = 1（疎な群れ）**: 個体は緩やかに群れを形成し、空間的に分散する。
- **cohesionWeight = 5（標準）**: 明確な群れ構造を形成しつつ、個体間に適度な距離を保つ。
- **cohesionWeight = 15（密な群れ）**: 個体は強く凝集し、密集した群れを形成する。

#### 3.2.3 捕食者回避行動

被捕食者は捕食者を検知すると、逃避行動を取る。

```
捕食者との距離 < 15m のとき：
    逃避力 = SteerTowards(捕食者と逆方向) × 15.0
```

この設計により、被捕食者は捕食者を視認すると積極的に逃げるが、逃げ切ることは難しい（捕食者の方が速い）。群れを形成し、Confusion Effect を発揮することが生存戦略として重要となる。

### 3.3 捕食者（ConfusionPredator）のモデル

捕食者は Ioannou et al. (2008) の論文 Fig.2 に基づいて設計された。

#### 3.3.1 基本パラメータ

| パラメータ | 値 | 設計理由 |
|------------|-----|----------|
| speed | 10 m/s | 被捕食者（最大5 m/s）の2倍。追いかければ必ず追いつける設定 |
| viewRadius | 20 m | 十分広い視野を確保し、群れ全体を視認可能にする |
| viewAngle | 120° | 前方120度の視野角。側方と後方は見えない |
| blindAngle | 40° | 真後ろ40度は死角。背後からの接近を許容 |
| captureRadius | 1.2 m | この距離内に入った獲物を捕食 |
| baseTurnSpeed | 8 rad/s | 基本旋回速度。混乱時に低下する |
| boundaryRadius | 50 m | 活動範囲（被捕食者と同じ） |

**speed = 10 m/s の設計理由**:
捕食者が被捕食者より速いことは、自然界の多くの捕食者-被捕食者関係で観察される。本シミュレーションでは、速度差を2倍に設定することで、「逃げるだけでは生存できない」状況を作り出した。これにより、群れ形成による Confusion Effect の重要性が増す。

**viewAngle = 120°, blindAngle = 40° の設計理由**:
魚類の視野は種によって異なるが、多くの捕食性魚類は前方に広い両眼視野を持ち、後方に死角がある。この設定は、被捕食者が捕食者の死角に逃げ込む可能性を許容し、より現実的な相互作用を実現する。

#### 3.3.2 Confusion Effect のパラメータ

| パラメータ | 値 | 設計理由 |
|------------|-----|----------|
| confusionStrength | 0, 0.5, 1.0 | **実験Cで操作**。混乱の強さを制御 |
| maxConfusionCount | 10 | この数以上の魚が視野にいると最大混乱 |
| maxAngleDeviation | 30° | 混乱時の追跡角度ずれの最大値 |
| targetSwitchCooldown | 1.5 秒 | ターゲット切り替え後のクールダウン時間 |
| maxChaseDistance | 15 m | これより遠いターゲットは追跡を諦める |

**confusionStrength の設計理由**:
- **confusionStrength = 0**: 混乱なし。捕食者は常に最適な追跡を行う。対照群として設定。
- **confusionStrength = 0.5**: 中程度の混乱。視野内の個体数に応じて追跡精度が低下。
- **confusionStrength = 1.0**: 最大混乱。視野内に10匹以上いると追跡がほぼ不可能になる。

**maxConfusionCount = 10 の設計理由**:
Ioannou et al. (2008) の実験では、標的の数が5〜10程度で追跡精度が著しく低下することが示されている。これに基づき、10匹を最大混乱の閾値とした。

**targetSwitchCooldown = 1.5秒 の設計理由**:
論文 Fig.2 では、「視野に新しく入った個体に注意が移る」という行動が観察されている。しかし、この行動を忠実に再現すると、捕食者は頻繁にターゲットを切り替えて一匹も捕食できなくなる。クールダウンを設けることで、論文の行動を再現しつつ、実験として成立する程度の捕食を可能にした。

#### 3.3.3 ターゲット選択アルゴリズム（論文 Fig.2 準拠）

捕食者のターゲット選択は以下のロジックに従う。

```
1. 現在のターゲットが視界から外れた or 死亡 → 新しいターゲットを選択
2. 現在のターゲットが maxChaseDistance より遠い → 新しいターゲットを選択
3. クールダウンが終了 AND 新しく視界に入った魚がいる → その魚に切り替え（目移り）
4. それ以外 → 現在のターゲットを追跡し続ける
```

「最後に視界に入った魚をターゲットにする」という挙動は、Ioannou et al. (2008) の論文で観察された行動パターンの直接的な実装である。

#### 3.3.4 Confusion Effect の影響

視野内の個体数に応じて、以下の影響が捕食者に適用される。

```
混乱度 = min(視野内個体数 / maxConfusionCount, 1.0) × confusionStrength

追跡角度のずれ = maxAngleDeviation × 混乱度 × PerlinNoise
有効旋回速度 = baseTurnSpeed × (1 - 混乱度 × 0.5)
有効移動速度 = speed × (1 - 混乱度 × 0.15)
```

**Perlin Noise を使用する理由**:
単純なランダムノイズでは追跡方向が毎フレーム激しく変動し、不自然な動きになる。Perlin Noise を使用することで、時間的に滑らかに変化する「迷い」を表現した。

---

## 4. 実験条件の設計

### 4.1 実験グループの構成

| グループ | 操作変数 | 目的 |
|----------|----------|------|
| A（A1, A2, A3） | 初期個体数 | 群れサイズが捕食効率に与える影響を検証 |
| B（B1, B2, B3） | 結合力（cohesionWeight） | 群れの密度が捕食効率に与える影響を検証 |
| C（C1, C2, C3） | 混乱強度（confusionStrength） | Confusion Effect の直接的な効果を検証 |

### 4.2 各条件の詳細

#### 実験A：個体数の影響

| 条件 | 初期個体数 | Cohesion | Confusion | 目的 |
|------|------------|----------|-----------|------|
| A1 | 20 | 1 | 0.5 | 少数群れ（群れが形成されにくい） |
| A2 | 50 | 1 | 0.5 | 中規模群れ |
| A3 | 100 | 1 | 0.5 | 大規模群れ（Confusion Effect が発揮されやすい） |

**Cohesion = 1 の理由**: 個体数の純粋な影響を見るため、群れの密度は疎に固定した。密な群れでは個体数の影響と密度の影響が交絡する。

#### 実験B：結合力の影響

| 条件 | 初期個体数 | Cohesion | Confusion | 目的 |
|------|------------|----------|-----------|------|
| B1 | 100 | 1 | 0.5 | 疎な群れ（個体が分散） |
| B2 | 100 | 5 | 0.5 | 標準的な群れ密度 |
| B3 | 100 | 15 | 0.5 | 密な群れ（強く凝集） |

**個体数 = 100 の理由**: 十分な数の個体がいないと群れの密度の違いが明確にならない。100匹であれば、疎〜密のいずれの条件でも群れ構造が形成される。

#### 実験C：混乱強度の影響

| 条件 | 初期個体数 | Cohesion | Confusion | 目的 |
|------|------------|----------|-----------|------|
| C1 | 100 | 5 | 0 | 対照群（混乱なし） |
| C2 | 100 | 5 | 0.5 | 中程度の混乱 |
| C3 | 100 | 5 | 1.0 | 最大混乱 |

**Cohesion = 5 の理由**: 標準的な群れ密度で Confusion Effect の純粋な影響を測定する。疎すぎると視野内の個体数が少なく、Confusion Effect が発揮されにくい。

### 4.3 固定パラメータ

すべての実験で以下のパラメータは固定とした。

| カテゴリ | パラメータ | 値 | 理由 |
|----------|------------|-----|------|
| 被捕食者 | maxSpeed | 5 m/s | 捕食者より遅く設定し、速度差を確保 |
| 被捕食者 | perceptionRadius | 2.5 m | 局所的な群れ構造を維持 |
| 被捕食者 | 逃避範囲 | 15 m | 捕食者の視野（20m）より狭く設定 |
| 捕食者 | speed | 10 m/s | 被捕食者の2倍。追跡可能性を確保 |
| 捕食者 | viewRadius | 20 m | 十分な視野を確保 |
| 捕食者 | captureRadius | 1.2 m | 接触による捕食を表現 |
| 空間 | boundaryRadius | 50 m | 十分な遊泳空間を確保 |

---

## 5. 評価指標

### 5.1 主要指標

| 指標 | 定義 | 意義 |
|------|------|------|
| 最初の捕食までの時間 | 実験開始から1匹目を捕食するまでの秒数 | 捕食者が群れを発見し、最初の獲物を捕獲する効率を示す |
| 捕食率（captures/min） | 単位時間あたりの捕食数 | 捕食者の全体的な効率を示す |
| N匹捕食までの時間 | 実験開始からN匹（本実験では10匹）捕食するまでの秒数 | 捕食効率の総合的な指標 |

### 5.2 補助指標

| 指標 | 定義 | 意義 |
|------|------|------|
| 視野内個体数 | 捕食時に捕食者の視野内にいた被捕食者の数 | Confusion Effect の強度を間接的に示す |
| ターゲット切り替え回数 | 捕食者がターゲットを変更した総回数 | 論文 Fig.2 の「目移り」行動の頻度を示す |
| 群れの極性（Polarization） | 全個体の進行方向ベクトルの平均の大きさ（0〜1） | 群れの整列度を示す。1に近いほど揃っている |

---

## 6. 実験手順

### 6.1 実験前の準備

1. **Spawner の設定**: Hierarchy で Spawner オブジェクトを選択し、Inspector で `Spawn Count` を設定する。
2. **BoidSettings の設定**: Assets フォルダ内の BoidSettings アセットを選択し、`Cohesion Weight` を設定する。
3. **ConfusionPredator の設定**: Hierarchy で Predator オブジェクトを選択し、Inspector で `Confusion Strength` を設定する。
4. **ExperimentLogger の設定**: ExperimentLogger オブジェクトで実験条件（A1〜C3）を選択し、`BoidSettings` への参照を設定する。

### 6.2 実験の実行

1. Unity Editor で Play ボタンを押す。
2. シミュレーションが自動的に開始され、捕食者が被捕食者を追跡する。
3. 10匹捕食すると自動的に実験が終了し、データが保存される。
4. 結果は `Assets/ExperimentData/` フォルダに出力される。

### 6.3 出力ファイル

| ファイル | 内容 |
|----------|------|
| *_summary.txt | 実験条件、総捕食数、捕食率などの要約 |
| *_captures.csv | 各捕食イベントの詳細（時刻、視野内個体数など） |
| *_snapshots.csv | 5秒ごとの群れ状態のスナップショット |

---

## 7. 期待される結果

### 7.1 仮説1（個体数の影響）に対して

個体数が増加すると、視野内の個体数が増え、Confusion Effect により捕食率が低下すると予測される。ただし、個体数増加は「発見確率の増加」にもつながるため、Confusion Effect が弱い条件（Cohesion = 1）では逆の結果になる可能性がある。

### 7.2 仮説2（群れの密度の影響）に対して

結合力が高いほど群れが密集し、捕食者の視野内に同時に多数の個体が入る。これにより Confusion Effect が強く発揮され、捕食率が低下すると予測される。

### 7.3 仮説3（Confusion Effect の直接的影響）に対して

confusionStrength を増加させると、捕食者の追跡精度が低下し、捕食率が明確に低下すると予測される。C1（混乱なし）と C3（最大混乱）の間には大きな差が生じるはずである。

---

## 8. 参考文献

1. Ioannou, C. C., Tosh, C. R., Neville, L., & Krause, J. (2008). The confusion effect—from neural networks to reduced predation risk. *Behavioral Ecology*, 19(1), 126-130.

2. Reynolds, C. W. (1987). Flocks, herds and schools: A distributed behavioral model. *ACM SIGGRAPH Computer Graphics*, 21(4), 25-34.

3. Couzin, I. D., Krause, J., James, R., Ruxton, G. D., & Franks, N. R. (2002). Collective memory and spatial sorting in animal groups. *Journal of Theoretical Biology*, 218(1), 1-11.

4. Krause, J., & Ruxton, G. D. (2002). *Living in groups*. Oxford University Press.

5. Pitcher, T. J. (Ed.). (1993). *Behaviour of teleost fishes* (2nd ed.). Chapman & Hall.
